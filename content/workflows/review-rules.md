# Review Rules Workflow

## 概述 (Overview)

本流程定义如何在审稿阶段从用户反馈中捕获新的创作规则，并将其写入规则文件。流程在主线对话中完成，无需子代理。

---

## Prerequisites

- 至少存在一个规则文件（`global-rules.md`、`profiles/{lang}-rules.md`、`styles/{style}/style-rules.md` 或 `projects/{project}/project-rules.md` 之一）

---

## Trigger

当用户说出以下类型的话，或使用 `/add-rule` 命令时，启动本流程：

| 类型 | 示例 |
|------|------|
| 停止某行为 | 「以后不要这样写」「别再这样」「这个问题以后注意」 |
| 保持某行为 | 「这个保持」「这个手法很好」「以后都这样写」 |
| 明确指令 | `/add-rule` |

---

## Step-by-Step Process

### Step 1: Understand feedback

- [ ] 解析用户反馈，识别具体的写作行为（写什么、怎么写、不写什么、不怎么写）
- [ ] 若表述模糊，用示例追问澄清：「能举一个具体例子吗？比如哪一段文字？」

---

### Step 2: Classify direction

- [ ] **Do (✅ 坚持)**：用户希望保持/延续该行为
- [ ] **Don't (❌ 避免)**：用户希望停止/禁止该行为

---

### Step 3: Classify severity

- [ ] 将规则归入以下级别之一：

| 级别 | 英文 | 说明 | 判定标准 |
|------|------|------|----------|
| 严重 | Critical | 硬约束，不可违反 / 必须始终遵守 | 事实一致性、重大风格违规、角色人设崩塌 |
| 重要 | Important | 强约束，偶有例外可接受 | 对风格有明确影响的偏好 |
| 偏好 | Preference | 尽量遵守 | 次要的风格偏好 |

- [ ] 给出分类及理由，并请用户确认或调整

---

### Step 4: Recommend level (which file to write to)

- [ ] 根据规则适用范围，推荐目标文件：

| 目标文件 | 适用场景 | 示例 |
|----------|----------|------|
| `global-rules.md` | 适用于所有写作，与风格/项目无关 | 「永远不要用『不禁』」 |
| `profiles/{lang}-rules.md` | 语言相关，但跨风格通用 | 「中文标点偏好：用全角逗号」 |
| `styles/{style}/style-rules.md` | 与当前风格特性相关 | 「武侠风格中，不要过度技术化描写武功」 |
| `projects/{project}/project-rules.md` | 仅限本项目/本角色 | 「李明从不使用感叹号」 |

- [ ] 说明推荐理由，并请用户确认

---

### Step 5: Draft rule entry

- [ ] 按以下格式起草规则条目：

```
- [规则描述]
  > 来源：[触发此规则的章节/草稿]，[日期]
  > [正面/反面]示例：[从实际文本中引用的示例]
```

- [ ] 将草稿展示给用户确认

---

### Step 6: Write to file

- [ ] 追加到正确文件的正确区块（坚持/避免，对应严重程度）
- [ ] 包含时间戳

---

## Examples

### Severity examples

| 级别 | 坚持 (Do) 示例 | 避免 (Don't) 示例 |
|------|----------------|-------------------|
| **严重** | 李明是左撇子，所有动作描写必须体现这一点 | 不得改变已确立的时间线（如第3章已写明事件发生在周二） |
| **重要** | 对话中多用短句，少用从句 | 避免在紧张场景中使用「不禁」「不由得」等弱化动词 |
| **偏好** | 环境描写优先用视觉和听觉，少用嗅觉 | 尽量少用「仿佛」「似乎」开头 |

### Target file examples

| 目标文件 | 规则示例 |
|----------|----------|
| `global-rules.md` | 禁止使用「不禁」「不由得」等弱化动词 |
| `profiles/zh-CN-rules.md` | 中文对话使用「」而非 "" 作为引号 |
| `styles/wuxia/style-rules.md` | 武侠风格中，武功描写以意境为主，不写具体招式名称 |
| `projects/mystery-001/project-rules.md` | 本项目中，侦探王明从不使用第一人称叙述 |

---

## Edge Cases

### 1. 用户要修改已有规则

- 在对应规则文件中搜索相关描述或关键词
- 找到后，在原位置更新（不追加新条目）
- 更新时保留或调整「来源」和「示例」信息

### 2. 用户要删除某条规则

- 找到该规则
- 向用户确认：「确定要删除这条规则吗？」
- 确认后从文件中移除

### 3. 新规则与已有规则冲突

- 若新规则与已有规则在**不同层级**（如 global vs project）冲突：
  - 告知用户存在冲突
  - 说明：**更具体的规则优先**（project > style > global）
  - 请用户选择：保留哪条、修改哪条，或合并为一条

### 4. 用户反馈无法明确归类

- 先完成 Step 1 的澄清
- 若仍无法确定，可暂时写入 `project-rules.md` 的「偏好」区块，并标注「待确认」
- 在后续审稿中根据更多反馈再调整

---

## Quick Reference: Rule File Structure

规则文件建议包含以下区块（按严重程度排序）：

```markdown
## 坚持 (Do)

### 严重
- ...

### 重要
- ...

### 偏好
- ...

## 避免 (Don't)

### 严重
- ...

### 重要
- ...

### 偏好
- ...
```
